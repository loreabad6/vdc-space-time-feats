<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Computational notebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="vdc-showcase_files/libs/clipboard/clipboard.min.js"></script>
<script src="vdc-showcase_files/libs/quarto-html/quarto.js"></script>
<script src="vdc-showcase_files/libs/quarto-html/popper.min.js"></script>
<script src="vdc-showcase_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="vdc-showcase_files/libs/quarto-html/anchor.min.js"></script>
<link href="vdc-showcase_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="vdc-showcase_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="vdc-showcase_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="vdc-showcase_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="vdc-showcase_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#context" id="toc-context" class="nav-link active" data-scroll-target="#context"><span class="header-section-number">1</span> Context</a></li>
  <li><a href="#libraries" id="toc-libraries" class="nav-link" data-scroll-target="#libraries"><span class="header-section-number">2</span> Libraries</a></li>
  <li><a href="#data-and-pre-processing" id="toc-data-and-pre-processing" class="nav-link" data-scroll-target="#data-and-pre-processing"><span class="header-section-number">3</span> Data and pre-processing</a>
  <ul class="collapse">
  <li><a href="#lava-flows-in-fagradalsfjall-iceland" id="toc-lava-flows-in-fagradalsfjall-iceland" class="nav-link" data-scroll-target="#lava-flows-in-fagradalsfjall-iceland"><span class="header-section-number">3.1</span> Lava flows in Fagradalsfjall, Iceland</a>
  <ul class="collapse">
  <li><a href="#repository-description" id="toc-repository-description" class="nav-link" data-scroll-target="#repository-description"><span class="header-section-number">3.1.1</span> Repository description</a></li>
  <li><a href="#files" id="toc-files" class="nav-link" data-scroll-target="#files"><span class="header-section-number">3.1.2</span> Files</a></li>
  <li><a href="#download-and-read" id="toc-download-and-read" class="nav-link" data-scroll-target="#download-and-read"><span class="header-section-number">3.1.3</span> Download and read</a></li>
  <li><a href="#explore" id="toc-explore" class="nav-link" data-scroll-target="#explore"><span class="header-section-number">3.1.4</span> Explore</a></li>
  <li><a href="#prepare-for-vdc" id="toc-prepare-for-vdc" class="nav-link" data-scroll-target="#prepare-for-vdc"><span class="header-section-number">3.1.5</span> Prepare for VDC</a></li>
  </ul></li>
  <li><a href="#landslide-in-butangbunasi-taiwan" id="toc-landslide-in-butangbunasi-taiwan" class="nav-link" data-scroll-target="#landslide-in-butangbunasi-taiwan"><span class="header-section-number">3.2</span> Landslide in Butangbunasi, Taiwan</a>
  <ul class="collapse">
  <li><a href="#repository-description-1" id="toc-repository-description-1" class="nav-link" data-scroll-target="#repository-description-1"><span class="header-section-number">3.2.1</span> Repository description</a></li>
  <li><a href="#files-1" id="toc-files-1" class="nav-link" data-scroll-target="#files-1"><span class="header-section-number">3.2.2</span> Files</a></li>
  <li><a href="#download-and-read-1" id="toc-download-and-read-1" class="nav-link" data-scroll-target="#download-and-read-1"><span class="header-section-number">3.2.3</span> Download and read</a></li>
  <li><a href="#explore-1" id="toc-explore-1" class="nav-link" data-scroll-target="#explore-1"><span class="header-section-number">3.2.4</span> Explore</a></li>
  <li><a href="#prepare-for-vdc-1" id="toc-prepare-for-vdc-1" class="nav-link" data-scroll-target="#prepare-for-vdc-1"><span class="header-section-number">3.2.5</span> Prepare for VDC</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#vdc-creation" id="toc-vdc-creation" class="nav-link" data-scroll-target="#vdc-creation"><span class="header-section-number">4</span> VDC creation</a>
  <ul class="collapse">
  <li><a href="#array-format" id="toc-array-format" class="nav-link" data-scroll-target="#array-format"><span class="header-section-number">4.1</span> Array format</a>
  <ul class="collapse">
  <li><a href="#lava-flow-vdc" id="toc-lava-flow-vdc" class="nav-link" data-scroll-target="#lava-flow-vdc"><span class="header-section-number">4.1.1</span> Lava flow VDC</a></li>
  <li><a href="#landslide-vdc" id="toc-landslide-vdc" class="nav-link" data-scroll-target="#landslide-vdc"><span class="header-section-number">4.1.2</span> Landslide VDC</a></li>
  </ul></li>
  <li><a href="#tabular-format" id="toc-tabular-format" class="nav-link" data-scroll-target="#tabular-format"><span class="header-section-number">4.2</span> Tabular format</a>
  <ul class="collapse">
  <li><a href="#lava-flow-vdc-1" id="toc-lava-flow-vdc-1" class="nav-link" data-scroll-target="#lava-flow-vdc-1"><span class="header-section-number">4.2.1</span> Lava flow VDC</a></li>
  <li><a href="#landslide-vdc-1" id="toc-landslide-vdc-1" class="nav-link" data-scroll-target="#landslide-vdc-1"><span class="header-section-number">4.2.2</span> Landslide VDC</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#showcase" id="toc-showcase" class="nav-link" data-scroll-target="#showcase"><span class="header-section-number">5</span> Showcase</a>
  <ul class="collapse">
  <li><a href="#cube-operations" id="toc-cube-operations" class="nav-link" data-scroll-target="#cube-operations"><span class="header-section-number">5.1</span> Cube operations</a>
  <ul class="collapse">
  <li><a href="#geometric-measurements" id="toc-geometric-measurements" class="nav-link" data-scroll-target="#geometric-measurements"><span class="header-section-number">5.1.1</span> Geometric measurements</a></li>
  <li><a href="#subsetting-dimensions" id="toc-subsetting-dimensions" class="nav-link" data-scroll-target="#subsetting-dimensions"><span class="header-section-number">5.1.2</span> Subsetting dimensions</a></li>
  <li><a href="#selecting-attributes" id="toc-selecting-attributes" class="nav-link" data-scroll-target="#selecting-attributes"><span class="header-section-number">5.1.3</span> Selecting attributes</a></li>
  <li><a href="#filtering-time" id="toc-filtering-time" class="nav-link" data-scroll-target="#filtering-time"><span class="header-section-number">5.1.4</span> Filtering time</a></li>
  <li><a href="#crs-transformation" id="toc-crs-transformation" class="nav-link" data-scroll-target="#crs-transformation"><span class="header-section-number">5.1.5</span> CRS transformation</a></li>
  <li><a href="#differences-in-time-series" id="toc-differences-in-time-series" class="nav-link" data-scroll-target="#differences-in-time-series"><span class="header-section-number">5.1.6</span> Differences in time series</a></li>
  </ul></li>
  <li><a href="#visualisation" id="toc-visualisation" class="nav-link" data-scroll-target="#visualisation"><span class="header-section-number">5.2</span> Visualisation</a>
  <ul class="collapse">
  <li><a href="#maps-with-array-vdcs" id="toc-maps-with-array-vdcs" class="nav-link" data-scroll-target="#maps-with-array-vdcs"><span class="header-section-number">5.2.1</span> Maps with array VDCs</a></li>
  <li><a href="#multi-dimensional-plot" id="toc-multi-dimensional-plot" class="nav-link" data-scroll-target="#multi-dimensional-plot"><span class="header-section-number">5.2.2</span> Multi-dimensional plot</a></li>
  <li><a href="#time-series-plots" id="toc-time-series-plots" class="nav-link" data-scroll-target="#time-series-plots"><span class="header-section-number">5.2.3</span> Time series plots</a></li>
  <li><a href="#glyph-maps" id="toc-glyph-maps" class="nav-link" data-scroll-target="#glyph-maps"><span class="header-section-number">5.2.4</span> Glyph maps</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6</span> References</a></li>
  <li><a href="#sec-session" id="toc-sec-session" class="nav-link" data-scroll-target="#sec-session"><span class="header-section-number">7</span> R Session Info</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="vdc-showcase.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Computational notebook</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="context" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Context</h1>
<p>This is a computational notebook to accompany the short paper manuscript “Vector data cubes for features evolving in space and time” submitted to AGILE 2024.</p>
<p>In this notebook, the expanded code on how to create vector data cubes (VDC) for shape-shifting features as described in section 3.2 (Vector data cube implementation) is included.</p>
<p>Note that the stand-alone code to recreate the figures of the manuscript can be browsed here (<a href="code/manuscript-figures.qmd">manuscript-figures.qmd</a>).</p>
<p>These experiments are performed in R v. 4.3.2 and further details on library versions are included at the end of the notebook.</p>
</section>
<section id="libraries" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Libraries</h1>
<p>The following chunk installs the needed libraries. Run only if overwriting current installations is not an issue. Note that <code>cubble</code> and <code>ggnewscale</code> come from the GitHub repository. <code>tmap</code> is installed from r-universe to work with version 4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pkgs <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dplyr"</span>,<span class="st">"ggplot2"</span>,<span class="st">"here"</span>,<span class="st">"patchwork"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"purrr"</span>,<span class="st">"readr"</span>,<span class="st">"stringr"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyr"</span>,<span class="st">"tsibble"</span>,<span class="st">"units"</span>,<span class="st">"zen4R"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(pkgs)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"huizezhang-sherry/cubble"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"eliocamp/ggnewscale"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"loreabad6/sf"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"r-spatial/stars"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">'tmap'</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">repos =</span> <span class="fu">c</span>(<span class="st">'https://r-tmap.r-universe.dev'</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'https://cloud.r-project.org'</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The libraries needed to reproduce this notebook are listed below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cubble) <span class="co"># tabular VDCs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># data wrangling</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># visualisation</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale) <span class="co"># add second color/fill scale in ggplot</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># manage current directory</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># plot composer</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr) <span class="co"># functional programming </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr) <span class="co"># read CSV files</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># read vector files</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars) <span class="co"># array VDCs</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># handle strings</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># create tidy data</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap) <span class="co"># spatial visualisation</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble) <span class="co"># handle time series data</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units) <span class="co"># set units</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(zen4R) # download data from zenodo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-and-pre-processing" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data and pre-processing</h1>
<p>Both data sets are shared through Zenodo, therefore we will directly fetch the necessary data from this repository using <code>zen4R</code>.</p>
<section id="lava-flows-in-fagradalsfjall-iceland" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="lava-flows-in-fagradalsfjall-iceland"><span class="header-section-number">3.1</span> Lava flows in Fagradalsfjall, Iceland</h2>
<p>The lava flow outlines for the Fagradalsfjall eruption can be obtained from <span class="citation" data-cites="pedersen_2023_7866738">Pedersen et al. (<a href="#ref-pedersen_2023_7866738" role="doc-biblioref">2023</a>)</span>.</p>
<section id="repository-description" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="repository-description"><span class="header-section-number">3.1.1</span> Repository description</h3>
<p>This is the description attached to the repository.</p>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>zenodo <span class="ot">=</span> <span class="fu">get_zenodo</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">doi =</span> <span class="st">"10.5281/zenodo.7866738"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>zenodo<span class="sc">$</span>metadata<span class="sc">$</span>description</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="files" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="files"><span class="header-section-number">3.1.2</span> Files</h3>
<p>As we see, the vector data format is GeoPackage. These are the files contained in the repository:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>zenodo<span class="sc">$</span>files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From an inspection on the Zenodo listing we could see that the outline for each date is saved as a different file.</p>
</section>
<section id="download-and-read" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="download-and-read"><span class="header-section-number">3.1.3</span> Download and read</h3>
<p>Hence, we will download only the outlines zipped file, unzip and create a list of the GeoPackage files to read into memory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">=</span> <span class="fu">tempdir</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download_zenodo</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">doi =</span> <span class="st">"10.5281/zenodo.7866738"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> dir,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> <span class="fu">list</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outlines_pedersen_etal2022_v12.zip"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeout =</span> <span class="dv">600</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Unzip</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">list.files</span>(<span class="fu">here</span>(dir), <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(files, unzip, <span class="at">exdir =</span> <span class="fu">here</span>(dir, <span class="st">"unzipped"</span>))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Find geopackage files</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>fn_gpkg <span class="ot">=</span> <span class="fu">list.files</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(dir, <span class="st">"unzipped"</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"Outline.*gpkg$"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">recursive =</span> <span class="cn">TRUE</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this we can read in the files into R as an <code>sf</code> object, where we combine all the files into one. The filename is kept to extract the date information from it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create function to read in each file and to extract </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the date from the filename</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>read_fun <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>(x) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fn_gpkg =</span> <span class="fu">tail</span>(<span class="fu">str_split</span>(x, <span class="st">'/'</span>)[[<span class="dv">1</span>]], <span class="at">n=</span><span class="dv">1</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">datetime =</span> <span class="fu">as.POSIXct</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="fu">str_split</span>(fn_gpkg, <span class="st">"_"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">collapse =</span> <span class="st">""</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">"%Y%m%d%H%M"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># One file does not have a crs set</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="dv">3057</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Call map2 to read in the files</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># and bind them into one single sf object</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>outlines_lf <span class="ot">=</span> <span class="fu">map</span>(fn_gpkg, read_fun) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_crs&lt;- : replacing crs does not reproject data; use st_transform for
that</code></pre>
</div>
</div>
</section>
<section id="explore" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="explore"><span class="header-section-number">3.1.4</span> Explore</h3>
<p>We can look at the final object and have an initial idea of the contents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>outlines_lf <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 9
$ geom     &lt;GEOMETRY [m]&gt; POLYGON ((339233.7 380352.7..., POLYGON ((339159.3 3…
$ fn_gpkg  &lt;chr&gt; "Outline_20210320_0745_HEL_Pedersen_etal2022_v12.gpkg", "Outl…
$ datetime &lt;dttm&gt; 2021-03-20 07:45:00, 2021-03-20 12:40:00, 2021-03-21 11:30:0…
$ id       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ Area     &lt;dbl&gt; NA, NA, 139224, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ layer    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "aoi_20210405_aft_sit…
$ path     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "/run/user/1000/gvfs/…
$ STD_ID1  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ BLN_Flag &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
</div>
</div>
<p>As seen, the columns accompanying the data are not complete and also do not provide extra information. We will mainly focus on the geometry and the datetime registered. We can take a short look at the polygons included in the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outlines_lf) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> datetime), <span class="at">fill =</span> <span class="cn">NA</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prepare-for-vdc" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5" class="anchored" data-anchor-id="prepare-for-vdc"><span class="header-section-number">3.1.5</span> Prepare for VDC</h3>
<p>The final step is to make sure we have a single geometry per timestamp. For this, we group by datetime and summarise the geometries for each data with a union. We add a step to make the geometry valid in case the union operation caused any topological issues.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>outlines_lf <span class="ot">=</span> outlines_lf <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine polygons from single date into multipolygons</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(datetime) <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geom =</span> <span class="fu">st_combine</span>(geom)) <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make geometry valid</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now our data is ready to be coerced to a VDC.</p>
</section>
</section>
<section id="landslide-in-butangbunasi-taiwan" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="landslide-in-butangbunasi-taiwan"><span class="header-section-number">3.2</span> Landslide in Butangbunasi, Taiwan</h2>
<p>The Butangbunasi landslide outlines can be obtained from <span class="citation" data-cites="Hoelbling_2024_Butangbunasidata">Hölbling et al. (<a href="#ref-Hoelbling_2024_Butangbunasidata" role="doc-biblioref">2024</a>)</span>.</p>
<section id="repository-description-1" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="repository-description-1"><span class="header-section-number">3.2.1</span> Repository description</h3>
<p>This is the description attached to the repository.</p>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>zenodo <span class="ot">=</span> <span class="fu">get_zenodo</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">doi =</span> <span class="st">"10.5281/zenodo.10635102"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>zenodo<span class="sc">$</span>metadata<span class="sc">$</span>description</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="files-1" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="files-1"><span class="header-section-number">3.2.2</span> Files</h3>
<p>Again, the vector data format is GeoPackage. These are the files contained in the repository:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>zenodo<span class="sc">$</span>files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-and-read-1" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="download-and-read-1"><span class="header-section-number">3.2.3</span> Download and read</h3>
<p>From exploring the repository and checking the description, we concluded the “Butangbunasi_OBIA_statistics.csv” also contains valuable information that can be join into the outline data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch also the CSV file with additional info</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">=</span> <span class="fu">tempdir</span>()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download_zenodo</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">doi =</span> <span class="st">"10.5281/zenodo.10635102"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> dir,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> <span class="fu">list</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outlines.zip"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Butangbunasi_OBIA_statistics.csv"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">timeout =</span> <span class="dv">100</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Unzip</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">list.files</span>(<span class="fu">here</span>(dir), <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(files, unzip, <span class="at">exdir =</span> <span class="fu">here</span>(dir, <span class="st">"unzipped"</span>))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Find geopackage files</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>mapping_ls <span class="ot">=</span> <span class="fu">list.files</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(dir, <span class="st">"unzipped"</span>, <span class="st">"outlines"</span>), </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">".gpkg"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then read in the CSV file and the outline files. With a left join, we can obtain the date and other columns from the CSV file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in CSV file</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">=</span> <span class="fu">read_csv</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(dir, <span class="st">"Butangbunasi_OBIA_statistics.csv"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set-up a read function that fetches filename</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>read_fun <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_sf</span>(x) <span class="sc">|&gt;</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">fn_gpkg =</span> <span class="fu">tail</span>(<span class="fu">str_split</span>(x, <span class="st">'/'</span>)[[<span class="dv">1</span>]], <span class="at">n=</span><span class="dv">1</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Read files and combine into single sf object</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with CSV file</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>outlines_ldsl <span class="ot">=</span> <span class="fu">lapply</span>(mapping_ls, read_fun) <span class="sc">|&gt;</span> </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(stats, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fn_gpkg"</span> <span class="ot">=</span> <span class="st">"file"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explore-1" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="explore-1"><span class="header-section-number">3.2.4</span> Explore</h3>
<p>We can look at the final object and have an initial idea of the contents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>outlines_ldsl <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 124
Columns: 8
$ Area_ha           &lt;dbl&gt; 0.546875, 1.000000, 10.656250, 3.687500, 18.312500, …
$ Class             &lt;chr&gt; "landslide", "landslide", "landslide", "landslide", …
$ geom              &lt;POLYGON [m]&gt; POLYGON ((270075 2569820, 2..., POLYGON ((27…
$ fn_gpkg           &lt;chr&gt; "Butangbunasi_1984.gpkg", "Butangbunasi_1984.gpkg", …
$ satellite_sensor  &lt;chr&gt; "Landsat 5", "Landsat 5", "Landsat 5", "Landsat 5", …
$ date              &lt;date&gt; 1984-12-12, 1984-12-12, 1984-12-12, 1984-12-12, 198…
$ landslide_area_ha &lt;dbl&gt; 66.2500, 66.2500, 66.2500, 66.2500, 66.2500, 66.2500…
$ lake_area_ha      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<p>For this case, the CSV file added some extra information to the data, such as the satellite sensor and the landslide area. We see also the column class and lake area which suggests there is more than one class for this dataset. Let’s look at the polygons included in the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">arrange</span>(outlines_ldsl, <span class="fu">desc</span>(date))) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> date, <span class="at">fill =</span> Class), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">trans =</span> <span class="st">"date"</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"deepskyblue3"</span>, <span class="st">"peru"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>We see here that the data does not only contain the landslide outlines but also the delineation of a dammed lake.</p>
</section>
<section id="prepare-for-vdc-1" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="prepare-for-vdc-1"><span class="header-section-number">3.2.5</span> Prepare for VDC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>outlines_ldsl <span class="ot">=</span> outlines_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coerce date column to Date class</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove outline for 2018</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is a reference outline and does not follow a</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Typhoon event according to Hoelbling et al., 2020</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">!=</span> <span class="fu">as.Date</span>(<span class="st">"2018-11-08"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by date which in combination with summarise</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># will union all single polygons into a multipolygon</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, Class) <span class="sc">|&gt;</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarise sensor and area information for landslide</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sensor =</span> <span class="fu">first</span>(satellite_sensor),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_ldsl =</span> <span class="fu">set_units</span>(<span class="fu">first</span>(landslide_area_ha), <span class="st">'ha'</span>),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_lake =</span> <span class="fu">set_units</span>(<span class="fu">first</span>(lake_area_ha), <span class="st">'ha'</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># collapse the area column into a single one depending on Class</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">area =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      Class <span class="sc">==</span> <span class="st">"landslide"</span> <span class="sc">~</span> area_ldsl,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>      Class <span class="sc">==</span> <span class="st">"lake"</span> <span class="sc">~</span> area_lake</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"area_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Complete data for missing cases of date-Class combination</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(date, Class) <span class="sc">|&gt;</span> </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename the class column (lowercase)</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">class =</span> Class) <span class="sc">|&gt;</span> </span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert back to sf</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="vdc-creation" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> VDC creation</h1>
<section id="array-format" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="array-format"><span class="header-section-number">4.1</span> Array format</h2>
<p>We will start creating an array VDC for the shape-evolving features. For this, we create an array object containing the data, i.e., the measure, that in this case are the changing geometries, and the dimensions of the array that correspond to the length of unique summary geometries (in this case 1), and of unique datetime strings.</p>
<p>Finally, we create a dimensions object that includes the <em>summary geometry</em> for our shape-evolving features. This can be the union of all the changing geometries or the centroid of those or the point from which the lava erupts or the landslide scar, or any other point the analyst sees adequate.</p>
<section id="lava-flow-vdc" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="lava-flow-vdc"><span class="header-section-number">4.1.1</span> Lava flow VDC</h3>
<p>For the lava flow, we do not use a unique identifier (<code>id</code>) because this is the only feature of this class under analysis. That means we are not including a second lava flow, e.g.&nbsp;the one in Grindavík, in the same cube, although we could when data is available.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create array</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">array</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> outlines_lf<span class="sc">$</span>geom, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim =</span> <span class="fu">c</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(outlines_lf<span class="sc">$</span>datetime))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom_sum =</span> <span class="dv">1</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">unique</span>(outlines_lf<span class="sc">$</span>datetime)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dimensions object</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary geometry is the centroid of the union of all geometries</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># The point parameter indicates if the value refers to a point (location)</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># or to a pixel (area) value</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>dim_cent <span class="ot">=</span> <span class="fu">st_dimensions</span>(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom_sum =</span> <span class="fu">st_centroid</span>(<span class="fu">st_make_valid</span>(<span class="fu">st_union</span>(outlines_lf<span class="sc">$</span>geom))), </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">unique</span>(outlines_lf<span class="sc">$</span>datetime),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">point =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce to cube</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>(<span class="at">cube_arr_lf =</span> <span class="fu">st_as_stars</span>(</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">geometry =</span> a), </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> dim_cent)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
         geometry  
 MULTIPOLYGON : 2  
 POLYGON      :28  
 epsg:3057    : 0  
 +proj=lcc ...: 0  
dimension(s):
         from to               refsys point
geom_sum    1  1 ISN93 / Lambert 1993  TRUE
datetime    1 30              POSIXct FALSE
                                              values
geom_sum                       POINT (339860 380008)
datetime 2021-03-20 07:45:00,...,2021-09-30 14:20:00</code></pre>
</div>
</div>
<p>If we would use the union we will see under the values column of the <code>geom_sum</code> dimension not a <code>POINT</code> geometry as above but a <code>POLYGON</code> geometry. We illustrate this with an unsaved object, so we will keep working with the centroid as the <code>geom_sum</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dim_union <span class="ot">=</span> <span class="fu">st_dimensions</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom_sum =</span> <span class="fu">st_make_valid</span>(<span class="fu">st_union</span>(outlines_lf<span class="sc">$</span>geom)), </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">unique</span>(outlines_lf<span class="sc">$</span>datetime),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">point =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce to cube</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_stars</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">geometry =</span> a), </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> dim_union)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
         geometry  
 MULTIPOLYGON : 2  
 POLYGON      :28  
 epsg:3057    : 0  
 +proj=lcc ...: 0  
dimension(s):
         from to               refsys point
geom_sum    1  1 ISN93 / Lambert 1993 FALSE
datetime    1 30              POSIXct FALSE
                                              values
geom_sum              POLYGON ((339772 381144, 33...
datetime 2021-03-20 07:45:00,...,2021-09-30 14:20:00</code></pre>
</div>
</div>
</section>
<section id="landslide-vdc" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="landslide-vdc"><span class="header-section-number">4.1.2</span> Landslide VDC</h3>
<p>For the landslide example we have added also the landslide-dammed lake outlines. The lake has been present in seven of the Landsat scenes mapped and therefore can serve as an example on how to handle absence in the data, as well as a second feature set in a VDC.</p>
<p>In this example, we add <code>class</code> as an extra dimension, which will mark whether the shape-evolving geometry is a landslide or a lake. For this particular case this dimension becomes redundant since there are two classes and two summary geometries, however, when we deal with more landslides and associated lakes, this could become useful. We will notice data redundancy by checking the amount of geometries in the summary of the attributes, we had initially 40 geometries and now we have 80, with 53 empty geometries.</p>
<p>We will perform some extra data wrangling to create this cube. Namely, we compute the <em>summary geometry</em> on the original <code>sf</code> object and perform again a complete case check to fill values with <code>NA</code>s for every combination of <code>date</code>, <code>class</code> and <code>geom_sum</code>.</p>
<p>Further, this dataset contains other information that can be mapped to the attributes such as the sensor and area. We will construct separate arrays for these and add them all to the cube.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add geom_sum columns to original sf data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># will be used also to create tabular VDC</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>outlines_ldsl_m <span class="ot">=</span> outlines_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary geometry is the centroid of the union </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of all geometries per type</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom_sum =</span> <span class="fu">st_centroid</span>(<span class="fu">st_make_valid</span>(<span class="fu">st_union</span>(geom)))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(geom_sum, <span class="at">.after =</span> <span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">'geom_sum'</span>) </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete cases, saved as separate object, see tabular format</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>outlines_ldsl_c <span class="ot">=</span> outlines_ldsl_m <span class="sc">|&gt;</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(date, class, geom_sum) <span class="sc">|&gt;</span> </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">'geom_sum'</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create arrays</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>dims <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>geom_sum)),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>class)),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(<span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>date))</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>dnms <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom_sum =</span> <span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>geom_sum),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>class),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>date)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>geom <span class="ot">=</span> <span class="fu">array</span>(</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> outlines_ldsl_c<span class="sc">$</span>geom, </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim =</span> dims,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> dnms</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>area <span class="ot">=</span> <span class="fu">array</span>(</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> outlines_ldsl_c<span class="sc">$</span>area, </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim =</span> dims,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> dnms</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>sensor <span class="ot">=</span> <span class="fu">array</span>(</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> outlines_ldsl_c<span class="sc">$</span>sensor, </span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">dim =</span> dims,</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> dnms</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarise geometries to add in dimensions object</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>sumgeom <span class="ot">=</span> outlines_ldsl_c <span class="sc">|&gt;</span> </span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geom_sum =</span> <span class="fu">first</span>(geom_sum))</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dimensions object</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="co"># The point parameter indicates if the value refers to a point (location)</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="co"># or to a pixel (area) value</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>dim_cent <span class="ot">=</span> <span class="fu">st_dimensions</span>(</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom_sum =</span> sumgeom<span class="sc">$</span>geom_sum, </span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>class),</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">unique</span>(outlines_ldsl_c<span class="sc">$</span>date)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># point = c(TRUE, TRUE, FALSE)</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Coerce to cube</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>(<span class="at">cube_arr_ldsl =</span> <span class="fu">st_as_stars</span>(</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">geometry =</span> geom, <span class="at">area =</span> <span class="fu">set_units</span>(area, <span class="st">"ha"</span>), <span class="at">sensor =</span> sensor), </span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimensions =</span> dim_cent)</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 3 dimensions and 3 attributes
attribute(s):
              geometry     area [ha]         sensor          
 GEOMETRYCOLLECTION:53   Min.   :  3.328   Length:80         
 MULTIPOLYGON      :23   1st Qu.: 41.703   Class :character  
 POLYGON           : 4   Median :119.750   Mode  :character  
 epsg:32651        : 0   Mean   :151.641                     
 +proj=utm ...     : 0   3rd Qu.:177.383                     
                         Max.   :423.562                     
                         NA's   :53                          
dimension(s):
         from to                refsys point
geom_sum    1  2 WGS 84 / UTM zone 51N  TRUE
class       1  2                    NA FALSE
date        1 20                  Date FALSE
                                                 values
geom_sum POINT (274148 2567228), POINT (274148 2567228)
class                              lake     , landslide
date                          1984-12-12,...,2021-08-28</code></pre>
</div>
</div>
</section>
</section>
<section id="tabular-format" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="tabular-format"><span class="header-section-number">4.2</span> Tabular format</h2>
<p>For the tabular format we use <code>cubble</code>. We can either coerce the <code>stars</code> VDC into a <code>cubble</code> (as shown for the lava flow example), or we can create a <code>cubble</code> from the original <code>sf</code> object (as shown for the landslide example).</p>
<p>For this format, we need to define a <code>key</code> and <code>index.</code> The key is the identifier of the spatial face of the cube while the index is the identifier of the temporal face. We then use <code>index = time</code> and we should use <code>key = geom_sum</code>. This works when creating the <code>cubble</code> object but the algorithm to display the temporal face gets stuck as it tries to add a WKT geometry to every entry. There is one “hack” to handle this when coercing from a <code>stars</code> object. Internally, <code>cubble</code> adds an <code>id</code> column to the data, so we can call <code>key = id</code> and the cube creation in its spatial and temporal forms will work. This is the approach we use for the lava flow VDC. For the landslide VDC we added the column class as the key, which becomes then the identifier. Better ways to handle this will be suggested to <code>cubble</code> in future work.</p>
<section id="lava-flow-vdc-1" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="lava-flow-vdc-1"><span class="header-section-number">4.2.1</span> Lava flow VDC</h3>
<p>As mentioned above, this VDC is created from the <code>stars</code> VDC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="ot">=</span> <span class="fu">as_cubble</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  cube_arr_lf, <span class="at">key =</span> id, <span class="at">index =</span> datetime</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see the temporal and spatial faces of the cube. As we will see <code>ts</code> in the spatial table is a list column where the time series is stored as displayed in the temporal table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_spatial</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ The cubble is already in the nested form</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, nested form, [sf]
# spatial:  [339859.695427319, 380008.4903805, 339859.695427319,
#   380008.4903805], ISN93 / Lambert 1993
# temporal: datetime [dttm], geometry [GEOMETRY [m]]
     id       x       y            geom_sum ts               
* &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;         &lt;POINT [m]&gt; &lt;list&gt;           
1     1 339860. 380008. (339859.7 380008.5) &lt;tibble [30 × 2]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, long form
# temporal: 2021-03-20 07:45:00 -- 2021-09-30 14:20:00 [1m], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
      id datetime                                                       geometry
   &lt;int&gt; &lt;dttm&gt;                                                    &lt;POLYGON [m]&gt;
 1     1 2021-03-20 07:45:00 ((339233.7 380352.7, 339227.5 380350.7, 339222.2 3…
 2     1 2021-03-20 12:40:00 ((339159.3 380472.3, 339159.3 380472.3, 339159.1 3…
 3     1 2021-03-21 11:30:00 ((339355.4 380527.9, 339368.6 380521.4, 339369 380…
 4     1 2021-03-22 13:22:00 ((339207.9 380067.1, 339203.2 380057.7, 339199.6 3…
 5     1 2021-03-23 10:05:00 ((339066.8 380389.2, 339066.1 380390.5, 339062.6 3…
 6     1 2021-03-26 12:52:00 ((339502.9 380141.2, 339495 380144.6, 339493 38014…
 7     1 2021-03-29 13:19:00 ((339566.1 380135, 339558.8 380133.6, 339558.6 380…
 8     1 2021-03-30 13:11:00 ((339506.3 380309.3, 339505 380302.6, 339504.8 380…
 9     1 2021-03-31 12:10:00 ((339031.2 380289.6, 339032 380291, 339032.2 38029…
10     1 2021-04-05 10:10:00 ((339360.7 380154.9, 339360.2 380154.7, 339357.4 3…
# ℹ 20 more rows</code></pre>
</div>
</div>
<p>What is interesting from this tabular format is that the <code>tsibble</code> package is used under the hood to handle the temporal aspect. Therefore, information on time intervals is inferred from the given timestamps and it is therefore determined if the time series has any gaps.</p>
</section>
<section id="landslide-vdc-1" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="landslide-vdc-1"><span class="header-section-number">4.2.2</span> Landslide VDC</h3>
<p>For this VDC we will use the modified <code>sf</code> object for the landslide dataset. We have included here the version without the complete cases for the three dimensions because <code>cubble</code> throws an error for this (there is a duplication of indices). Further investigation into why this is the case will follow for future work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create cubble</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="ot">=</span> <span class="fu">as_cubble</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  outlines_ldsl_m, <span class="at">key =</span> class, <span class="at">index =</span> date</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>cubble</code> creation is now based on the object with complete cases for every combination of <code>date</code> and <code>class</code>. This means <code>NA</code> values and empty geometries are included. However, we could also build the <code>cubble</code> without this <code>NA</code> values, and hence avoid data redundancy (note the dimensions of the tibble in the list-column <code>ts</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_cubble</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(outlines_ldsl_m), <span class="at">key =</span> class, <span class="at">index =</span> date</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: class [2], index: date, nested form, [sf]
# spatial:  [271664.917737363, 2567227.57526178, 274148.347513089,
#   2568861.92906261], WGS 84 / UTM zone 51N
# temporal: date [date], sensor [chr], area [[ha]], geom [MULTIPOLYGON [m]]
  class           x        y           geom_sum ts               
* &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;        &lt;POINT [m]&gt; &lt;list&gt;           
1 landslide 271665. 2568862. (271664.9 2568862) &lt;tibble [20 × 4]&gt;
2 lake      274148. 2567228. (274148.3 2567228) &lt;tibble [7 × 4]&gt; </code></pre>
</div>
</div>
<p>For compatibility with the array format, we will keep the first approach as the tabular VDC. We can see the temporal and spatial faces of the cube. Here we note how the “lake” and “landslide” become the identifiers for the feature sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_spatial</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ The cubble is already in the nested form</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: class [2], index: date, nested form, [sf]
# spatial:  [271664.917737363, 2567227.57526178, 274148.347513089,
#   2568861.92906261], WGS 84 / UTM zone 51N
# temporal: date [date], sensor [chr], area [[ha]], geom [GEOMETRY [m]]
  class           x        y           geom_sum ts               
* &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;        &lt;POINT [m]&gt; &lt;list&gt;           
1 lake      274148. 2567228. (274148.3 2567228) &lt;tibble [20 × 4]&gt;
2 landslide 271665. 2568862. (271664.9 2568862) &lt;tibble [20 × 4]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: class [2], index: date, long form
# temporal: 1984-12-12 -- 2021-08-28 [8D], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
   class date       sensor     area                                         geom
   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;      [ha]                               &lt;GEOMETRY [m]&gt;
 1 lake  1984-12-12 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
 2 lake  1989-10-23 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
 3 lake  1990-10-10 Landsat 5  5.31 MULTIPOLYGON (((273887.5 2566870, 273887.5 …
 4 lake  1992-10-31 Landsat 5  3.33 POLYGON ((273950 2566870, 273925 2566870, 2…
 5 lake  1994-09-03 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
 6 lake  1996-08-23 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
 7 lake  1998-11-01 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
 8 lake  2000-09-27 Landsat 7  6.88 MULTIPOLYGON (((273925 2566782, 273862.5 25…
 9 lake  2001-09-14 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
10 lake  2004-07-12 &lt;NA&gt;      NA                        GEOMETRYCOLLECTION EMPTY
# ℹ 30 more rows</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="showcase" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Showcase</h1>
<p>In this section, we will demonstrate some of the operations that are supported now for VDCs, and some of the operations that we would like to implement in future work.</p>
<p>We will use the created cubes (lava flow, landslide) interchangeably, considering that most of the operations (given the data structure, e.g., extra dimensions, extra attributes) can be applied to both examples.</p>
<section id="cube-operations" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="cube-operations"><span class="header-section-number">5.1</span> Cube operations</h2>
<p>Most of <code>dplyr</code> verbs and <code>sf</code> functions work for the array and tabular cubes. For the tabular cubes, it is important to remember which face we want to apply the operation to.</p>
<section id="geometric-measurements" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="geometric-measurements"><span class="header-section-number">5.1.1</span> Geometric measurements</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>cube_arr_lf <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 2 attributes
attribute(s):
         geometry     area [m^2]     
 MULTIPOLYGON : 2   Min.   :  54517  
 POLYGON      :28   1st Qu.: 287810  
 epsg:3057    : 0   Median : 963505  
 +proj=lcc ...: 0   Mean   :1677119  
                    3rd Qu.:3084240  
                    Max.   :4848672  
dimension(s):
         from to               refsys point
geom_sum    1  1 ISN93 / Lambert 1993  TRUE
datetime    1 30              POSIXct FALSE
                                              values
geom_sum                       POINT (339860 380008)
datetime 2021-03-20 07:45:00,...,2021-09-30 14:20:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, long form
# temporal: 2021-03-20 07:45:00 -- 2021-09-30 14:20:00 [1m], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
      id datetime                                                geometry   area
   &lt;int&gt; &lt;dttm&gt;                                             &lt;POLYGON [m]&gt;  [m^2]
 1     1 2021-03-20 07:45:00 ((339233.7 380352.7, 339227.5 380350.7, 339… 5.45e4
 2     1 2021-03-20 12:40:00 ((339159.3 380472.3, 339159.3 380472.3, 339… 7.41e4
 3     1 2021-03-21 11:30:00 ((339355.4 380527.9, 339368.6 380521.4, 339… 1.37e5
 4     1 2021-03-22 13:22:00 ((339207.9 380067.1, 339203.2 380057.7, 339… 1.71e5
 5     1 2021-03-23 10:05:00 ((339066.8 380389.2, 339066.1 380390.5, 339… 1.88e5
 6     1 2021-03-26 12:52:00 ((339502.9 380141.2, 339495 380144.6, 33949… 2.40e5
 7     1 2021-03-29 13:19:00 ((339566.1 380135, 339558.8 380133.6, 33955… 2.75e5
 8     1 2021-03-30 13:11:00 ((339506.3 380309.3, 339505 380302.6, 33950… 2.85e5
 9     1 2021-03-31 12:10:00 ((339031.2 380289.6, 339032 380291, 339032.… 2.95e5
10     1 2021-04-05 10:10:00 ((339360.7 380154.9, 339360.2 380154.7, 339… 3.26e5
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="subsetting-dimensions" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="subsetting-dimensions"><span class="header-section-number">5.1.2</span> Subsetting dimensions</h3>
<p>Subsetting refers to lookup operations via an index. A way to subset a cube is to use the slice verb. Similar results can be achieved with <code>[</code>, but the syntax is not so intuitive and we need to know the dimension order. <!-- When a dimension after slicing has a single index it is dropped by default. --> <!-- Note how the number of geometries in the attributes changes. --></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cube_arr_lf <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="at">index =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">along =</span> <span class="st">"datetime"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
         geometry 
 MULTIPOLYGON :2  
 POLYGON      :8  
 epsg:3057    :0  
 +proj=lcc ...:0  
dimension(s):
         from to               refsys point
geom_sum    1  1 ISN93 / Lambert 1993  TRUE
datetime    3 12              POSIXct FALSE
                                              values
geom_sum                       POINT (339860 380008)
datetime 2021-03-21 11:30:00,...,2021-04-06 13:38:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>cube_arr_lf[,,<span class="dv">3</span><span class="sc">:</span><span class="dv">12</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
         geometry 
 MULTIPOLYGON :2  
 POLYGON      :8  
 epsg:3057    :0  
 +proj=lcc ...:0  
dimension(s):
         from to               refsys point
geom_sum    1  1 ISN93 / Lambert 1993  TRUE
datetime    3 12              POSIXct FALSE
                                              values
geom_sum                       POINT (339860 380008)
datetime 2021-03-21 11:30:00,...,2021-04-06 13:38:00</code></pre>
</div>
</div>
</section>
<section id="selecting-attributes" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="selecting-attributes"><span class="header-section-number">5.1.3</span> Selecting attributes</h3>
<p>We can select single attributes or columns. Note that for the tabular format the <code>key</code> and <code>index</code> behave as sticky columns and always stay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cube_arr_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sensor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 3 dimensions and 1 attribute
attribute(s):
   sensor          
 Length:80         
 Class :character  
 Mode  :character  
dimension(s):
         from to                refsys point
geom_sum    1  2 WGS 84 / UTM zone 51N  TRUE
class       1  2                    NA FALSE
date        1 20                  Date FALSE
                                                 values
geom_sum POINT (274148 2567228), POINT (274148 2567228)
class                              lake     , landslide
date                          1984-12-12,...,2021-08-28</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sensor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Missing attribute `class` and `date`, add it back.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: class [2], index: date, long form
# temporal: 1984-12-12 -- 2021-08-28 [8D], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
   class date       sensor   
   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;    
 1 lake  1984-12-12 &lt;NA&gt;     
 2 lake  1989-10-23 &lt;NA&gt;     
 3 lake  1990-10-10 Landsat 5
 4 lake  1992-10-31 Landsat 5
 5 lake  1994-09-03 &lt;NA&gt;     
 6 lake  1996-08-23 &lt;NA&gt;     
 7 lake  1998-11-01 &lt;NA&gt;     
 8 lake  2000-09-27 Landsat 7
 9 lake  2001-09-14 &lt;NA&gt;     
10 lake  2004-07-12 &lt;NA&gt;     
# ℹ 30 more rows</code></pre>
</div>
</div>
</section>
<section id="filtering-time" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="filtering-time"><span class="header-section-number">5.1.4</span> Filtering time</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>cube_arr_lf <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datetime <span class="sc">&gt;</span> <span class="st">"2021-03-18"</span>, datetime <span class="sc">&lt;</span> <span class="st">"2021-03-25"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
         geometry 
 POLYGON      :5  
 epsg:3057    :0  
 +proj=lcc ...:0  
dimension(s):
         from to               refsys point
geom_sum    1  1 ISN93 / Lambert 1993  TRUE
datetime    1  5              POSIXct FALSE
                                              values
geom_sum                       POINT (339860 380008)
datetime 2021-03-20 07:45:00,...,2021-03-23 10:05:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datetime <span class="sc">&gt;</span> <span class="st">"2021-03-18"</span>, datetime <span class="sc">&lt;</span> <span class="st">"2021-03-25"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, long form
# temporal: 2021-03-20 07:45:00 -- 2021-03-23 10:05:00 [1m], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
     id datetime                                                        geometry
  &lt;int&gt; &lt;dttm&gt;                                                     &lt;POLYGON [m]&gt;
1     1 2021-03-20 07:45:00 ((339233.7 380352.7, 339227.5 380350.7, 339222.2 38…
2     1 2021-03-20 12:40:00 ((339159.3 380472.3, 339159.3 380472.3, 339159.1 38…
3     1 2021-03-21 11:30:00 ((339355.4 380527.9, 339368.6 380521.4, 339369 3805…
4     1 2021-03-22 13:22:00 ((339207.9 380067.1, 339203.2 380057.7, 339199.6 38…
5     1 2021-03-23 10:05:00 ((339066.8 380389.2, 339066.1 380390.5, 339062.6 38…</code></pre>
</div>
</div>
</section>
<section id="crs-transformation" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="crs-transformation"><span class="header-section-number">5.1.5</span> CRS transformation</h3>
<p>Transforming the CRS of the VDC works for both the tabular and array formats.</p>
<p>For the tabular format, the changing geometries preserve their original CRS, even though the <em>summary_geometry</em> is modified for both formats.</p>
<p>For the array format, this issue is fixed thanks to <a href="https://github.com/edzer"><span class="citation" data-cites="edzer">(<span><strong>edzer?</strong></span>)</span></a>, see <a href="https://github.com/loreabad6/vdc-space-time-feats/issues/1">#1</a>.</p>
<p>In future implementations, the tabular format will have a better integration of the <em>summary geometry</em> and <em>shape-evolving geometries</em>, where both geometry-columns get updated with such operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>test_arr <span class="ot">=</span> cube_arr_lf <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>test_arr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
         geometry  
 MULTIPOLYGON : 2  
 POLYGON      :28  
 epsg:4326    : 0  
 +proj=long...: 0  
dimension(s):
         from to  refsys point                                      values
geom_sum    1  1  WGS 84  TRUE                        POINT (-22.26 63.89)
datetime    1 30 POSIXct FALSE 2021-03-20 07:45:00,...,2021-09-30 14:20:00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>test_arr<span class="sc">$</span>geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 30 features  [dim: 1 x 30]
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -22.29422 ymin: 63.86326 xmax: -22.2152 ymax: 63.89919
Geodetic CRS:  WGS 84
First 5 geometries:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((-22.27373 63.8894, -22.27385 63.88938...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((-22.27537 63.89044, -22.27537 63.8904...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((-22.27144 63.89103, -22.27116 63.8909...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((-22.27395 63.88683, -22.27403 63.8867...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((-22.27716 63.88965, -22.27717 63.8896...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>test_tab <span class="ot">=</span> cube_tab_lf <span class="sc">|&gt;</span>  </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_crs&lt;- : replacing crs does not reproject data; use st_transform for
that</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>test_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, nested form, [sf]
# spatial:  [-22.2606406589017, 63.8866116284422, -22.2606406589017,
#   63.8866116284422], ISN93 / Lambert 1993
# temporal: datetime [dttm], geometry [GEOMETRY [m]]
     id       x       y             geom_sum ts               
  &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;          &lt;POINT [m]&gt; &lt;list&gt;           
1     1 339860. 380008. (-22.26064 63.88661) &lt;tibble [30 × 2]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>test_tab <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, long form
# temporal: 2021-03-20 07:45:00 -- 2021-09-30 14:20:00 [1m], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
      id datetime                                                       geometry
   &lt;int&gt; &lt;dttm&gt;                                                    &lt;POLYGON [m]&gt;
 1     1 2021-03-20 07:45:00 ((339233.7 380352.7, 339227.5 380350.7, 339222.2 3…
 2     1 2021-03-20 12:40:00 ((339159.3 380472.3, 339159.3 380472.3, 339159.1 3…
 3     1 2021-03-21 11:30:00 ((339355.4 380527.9, 339368.6 380521.4, 339369 380…
 4     1 2021-03-22 13:22:00 ((339207.9 380067.1, 339203.2 380057.7, 339199.6 3…
 5     1 2021-03-23 10:05:00 ((339066.8 380389.2, 339066.1 380390.5, 339062.6 3…
 6     1 2021-03-26 12:52:00 ((339502.9 380141.2, 339495 380144.6, 339493 38014…
 7     1 2021-03-29 13:19:00 ((339566.1 380135, 339558.8 380133.6, 339558.6 380…
 8     1 2021-03-30 13:11:00 ((339506.3 380309.3, 339505 380302.6, 339504.8 380…
 9     1 2021-03-31 12:10:00 ((339031.2 380289.6, 339032 380291, 339032.2 38029…
10     1 2021-04-05 10:10:00 ((339360.7 380154.9, 339360.2 380154.7, 339357.4 3…
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="differences-in-time-series" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="differences-in-time-series"><span class="header-section-number">5.1.6</span> Differences in time series</h3>
<p>For the tabular format, we can use <code>tsibble</code> functions when coercing our cube into a temporal tsibble. One useful function is to calculate differences between timestamps. We use this for computing the difference in area (per feature class for the landslide example) below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">set_units</span>(<span class="fu">st_area</span>(geometry), <span class="st">"ha"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_temporal_tsibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">difference</span>(area, <span class="at">order_by =</span> datetime))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: id [1], index: datetime, long form, [tsibble]
# temporal: 2021-03-20 07:45:00 -- 2021-09-30 14:20:00 [1m], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
      id datetime                                           geometry  area  diff
   &lt;int&gt; &lt;dttm&gt;                                        &lt;POLYGON [m]&gt;  [ha]  [ha]
 1     1 2021-03-20 07:45:00 ((339233.7 380352.7, 339227.5 380350.7…  5.45 NA   
 2     1 2021-03-20 12:40:00 ((339159.3 380472.3, 339159.3 380472.3…  7.41  1.95
 3     1 2021-03-21 11:30:00 ((339355.4 380527.9, 339368.6 380521.4… 13.7   6.26
 4     1 2021-03-22 13:22:00 ((339207.9 380067.1, 339203.2 380057.7… 17.1   3.42
 5     1 2021-03-23 10:05:00 ((339066.8 380389.2, 339066.1 380390.5… 18.8   1.71
 6     1 2021-03-26 12:52:00 ((339502.9 380141.2, 339495 380144.6, … 24.0   5.23
 7     1 2021-03-29 13:19:00 ((339566.1 380135, 339558.8 380133.6, … 27.5   3.48
 8     1 2021-03-30 13:11:00 ((339506.3 380309.3, 339505 380302.6, … 28.5   1.02
 9     1 2021-03-31 12:10:00 ((339031.2 380289.6, 339032 380291, 33… 29.5   1.02
10     1 2021-04-05 10:10:00 ((339360.7 380154.9, 339360.2 380154.7… 32.6   3.02
# ℹ 20 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_temporal_tsibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">|&gt;</span> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">difference</span>(area, <span class="at">order_by =</span> date)) <span class="sc">|&gt;</span> </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">rev</span>(class))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># cubble:   key: class [2], index: date, long form, [tsibble]
# temporal: 1984-12-12 -- 2021-08-28 [8D], has gaps!
# spatial:  x [dbl], y [dbl], geom_sum [POINT [m]]
   class     date       sensor     area                              geom   diff
   &lt;chr&gt;     &lt;date&gt;     &lt;chr&gt;      [ha]                &lt;MULTIPOLYGON [m]&gt;   [ha]
 1 landslide 1984-12-12 Landsat 5  66.2 (((271637.5 2568620, 271637.5 25…  NA   
 2 landslide 1989-10-23 Landsat 5  62.4 (((273712.5 2566845, 273562.5 25…  -3.81
 3 landslide 1990-10-10 Landsat 5  78.2 (((273737.5 2566845, 273737.5 25…  15.8 
 4 landslide 1992-10-31 Landsat 5 121.  (((273462.5 2566820, 273462.5 25…  43.2 
 5 landslide 1994-09-03 Landsat 5  94.1 (((273500 2566820, 273462.5 2566… -27.4 
 6 landslide 1996-08-23 Landsat 5 118.  (((273462.5 2566820, 273462.5 25…  23.7 
 7 landslide 1998-11-01 Landsat 5  96.3 (((273775 2566820, 273712.5 2566… -21.5 
 8 landslide 2000-09-27 Landsat 7 120.  (((273500 2566782, 273500 256682…  23.4 
 9 landslide 2001-09-14 Landsat 7 121.  (((273825 2566820, 273825 256678…   1.22
10 landslide 2004-07-12 Landsat 5 123.  (((273825 2566932, 273862.5 2566…   2.31
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>Functions like spatial filtering and data aggregations would become more relevant when we deal with a larger number of feature sets, and will be explored for future implementations of the VDC concepts.</p>
</section>
</section>
<section id="visualisation" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="visualisation"><span class="header-section-number">5.2</span> Visualisation</h2>
<section id="maps-with-array-vdcs" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="maps-with-array-vdcs"><span class="header-section-number">5.2.1</span> Maps with array VDCs</h3>
<p><code>stars</code> plot methods in base R are a fast way to inspect information in data cubes. For the VDC array implementation, however, the <code>plot.stars()</code> method does not work by default, as the inclusion of the geometry as an attribute is not supported.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_arr_lf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in classInt::classIntervals(na.omit(values), min(nbreaks - 1, n.unq), : var is not numeric</code></pre>
</div>
</div>
<p>A workaround is to call the attribute directly, while if we want to perform operations in a pipeline and then plot we would need to use a lambda function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>oldpar <span class="ot">=</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cube_arr_lf<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cube_arr_lf <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datetime <span class="sc">&gt;</span> <span class="st">"2021-03-18"</span>, datetime <span class="sc">&lt;</span> <span class="st">"2021-03-25"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  (\(x) <span class="fu">plot</span>(x<span class="sc">$</span>geometry))()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Tidyverse plotting methods, i.e., <code>ggplot</code>s implementation for stars <code>geom_stars()</code> also does not know how to handle this geometry attribute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cube_arr_lf) <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stars</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `fortify()`:
! `data` must be a &lt;data.frame&gt;, or an object coercible by `fortify()`,
  or a valid &lt;data.frame&gt;-like object coercible by `as.data.frame()`.
Caused by error in `.prevalidate_data_frame_like_object()`:
! `colnames(data)` must return a &lt;character&gt; of length `ncol(data)`.</code></pre>
</div>
</div>
<p>Here, going to the tabular approach is a better solution. A pre-step is to assign the geometry to the changing geometry instead of <code>geom_sum</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rearrange df for plot order</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(datetime)) <span class="sc">|&gt;</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign sf column to changing geometry</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  (\(x) <span class="fu">st_as_sf</span>(x, <span class="at">sf_column_name =</span> <span class="st">"geometry"</span>))() <span class="sc">|&gt;</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>The advantage of using <code>ggplot2</code> is for example the use of facets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>cube_tab_lf <span class="sc">|&gt;</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rearrange df for plot order</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(datetime)) <span class="sc">|&gt;</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign sf column to changing geometry</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  (\(x) <span class="fu">st_as_sf</span>(x, <span class="at">sf_column_name =</span> <span class="st">"geometry"</span>))() <span class="sc">|&gt;</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>datetime) <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Other plotting packages like tmap (v4) can also be used in this manner.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rearrange df for plot order</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign sf column to changing geometry</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  (\(x) <span class="fu">st_as_sf</span>(x, <span class="at">sf_column_name =</span> <span class="st">"geom"</span>))() <span class="sc">|&gt;</span> </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"date"</span>, <span class="at">fill_alpha =</span> <span class="fl">0.9</span>, <span class="at">col =</span> <span class="st">"white"</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"-viridis"</span>)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_facets</span>(<span class="at">columns =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="2400"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multi-dimensional-plot" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="multi-dimensional-plot"><span class="header-section-number">5.2.2</span> Multi-dimensional plot</h3>
<p>In the paper we included an example of a multi-dimensional visualisation of the VDC data. This was achieved by adding a distortion to the geometries to make them appear stacked over each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create shear matrix</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>sm <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">1.2</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply shear matrix</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>ldsl_shear <span class="ot">=</span> outlines_ldsl <span class="sc">|&gt;</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> geom <span class="sc">*</span> sm,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sequence along date, i.e. 1 to 20 per class</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shift_y =</span> <span class="fu">rep</span>(</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(date)),</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">each =</span> <span class="fu">length</span>(<span class="fu">unique</span>(class))</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add lost crs</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(outlines_ldsl)) </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>ldsl_shift <span class="ot">=</span> ldsl_shear <span class="sc">|&gt;</span> </span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a shift to stack outlines on top of each other</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> geom <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">0</span>, shift_y <span class="sc">*</span> <span class="dv">4000</span>),</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Marker to place date labels</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_label =</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(geom))[,<span class="st">'Y'</span>]</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ldsl_shift) <span class="sc">+</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot landslide geometries</span></span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(ldsl_shift, class <span class="sc">==</span> <span class="st">"landslide"</span>),</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> date), </span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot lake geometries</span></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(ldsl_shift, class <span class="sc">==</span> <span class="st">"lake"</span>),</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="st">"pink"</span>,</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add date label, the value of x is added after visual inspection</span></span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(ldsl_shift, class <span class="sc">==</span> <span class="st">"landslide"</span>),</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> date, <span class="at">y =</span> y_label),</span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">3751500</span>, <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="st">"Date"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">trans =</span> <span class="st">"date"</span>, <span class="at">option =</span> <span class="st">"D"</span>) <span class="sc">+</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Limits are expanded after visual inspection</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">3745000</span>, <span class="dv">3767000</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">2575500</span>, <span class="dv">2647200</span>), <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>)</span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>We hope that future work allows us to address the unsupported features of VDC maps for standard plotting methods like base R, <code>ggplot2</code> and <code>tmap</code> and that we can add more visualisation options like the multi-dimensional plot.</p>
</section>
<section id="time-series-plots" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="time-series-plots"><span class="header-section-number">5.2.3</span> Time series plots</h3>
<p>As we are working with spatio-temporal data, to visualise the time component comes as natural. We can extract information both from the array and tabular format to do so.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  cube_arr_ldsl<span class="sc">$</span>area,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'deepskyblue3'</span>,<span class="st">'peru'</span>), <span class="dv">10</span>),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">19</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>If we want to use tidyverse methods, the tabular VDC presents a more straightforward syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> date, <span class="at">y =</span> area,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> date,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> sensor, </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> class</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Date"</span>, <span class="at">direction =</span> <span class="dv">1</span>,</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> <span class="st">"date"</span>, <span class="at">option =</span> <span class="st">"D"</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `scale_name` argument of `continuous_scale()` is deprecated as of ggplot2
3.5.0.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="glyph-maps" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="glyph-maps"><span class="header-section-number">5.2.4</span> Glyph maps</h3>
<p><code>cubble</code> includes glyph maps as one of their main features. The idea is to summarise time series data in a map format. The concept works as an innovative way to communicate spatio-temporal variation.</p>
<p>Here we have used it to show the landslides and lake area time series. The glyphs are located in the <code>geom_sum</code> coordinates. This type of visualisation becomes handy when dealing with several feature sets in an area and to have a fast overview of large changes per location. We included the landslide and lake delineations as background for reference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>cube_tab_ldsl <span class="sc">|&gt;</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">face_temporal</span>() <span class="sc">|&gt;</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make the x and y coordinates explicit on the temporal table </span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to pass onto ggplot aesthetics</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unfold</span>(x, y) <span class="sc">|&gt;</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add delineations as background for reference</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">st_as_sf</span>(<span class="fu">face_temporal</span>(cube_tab_ldsl), <span class="at">sf_column_name =</span> <span class="st">"geom"</span>),</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit.aes =</span> F, <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> class), </span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> T</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Landform type"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"deepskyblue3"</span>, <span class="st">"peru"</span>)) <span class="sc">+</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale_color</span>() <span class="sc">+</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># map aesthetics for glyph maps</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x_major =</span> x, <span class="at">y_major =</span> y,</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">x_minor =</span> date, </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_minor =</span> <span class="fu">unclass</span>(area)) <span class="sc">+</span></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot glyphs</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_glyph_box</span>(</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">510</span>, <span class="at">height =</span> <span class="dv">400</span>,</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_glyph</span>(</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">500</span>,  <span class="at">height =</span> <span class="dv">390</span>,</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">drop_units</span>(<span class="fu">set_units</span>(area, <span class="st">"km^2"</span>)))</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expression</span>(<span class="st">"Area [ha]"</span>),</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">option =</span> <span class="st">"D"</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bring CRS back</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="fu">st_crs</span>(cube_tab_ldsl)</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values or values outside the scale range
(`geom_glyph_box()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 13 rows containing missing values or values outside the scale range
(`geom_glyph()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="vdc-showcase_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(oldpar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="references" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Hoelbling_2024_Butangbunasidata" class="csl-entry" role="listitem">
Hölbling, Daniel, Lorena Abad, Zahra Dabiri, Prasicek, and Anne-Laure Argentin. 2024. <span>“Butangbunasi Landslide and Landslide-Dammed Lake Outlines Based on Landsat Time Series with Respect to Typhoons.”</span> Zenodo. <a href="https://doi.org/10.5281/zenodo.10635102">https://doi.org/10.5281/zenodo.10635102</a>.
</div>
<div id="ref-pedersen_2023_7866738" class="csl-entry" role="listitem">
Pedersen, Gro B. M., Joaquin M. C. Belart, Birgir Vilhelm Óskarsson, Magnús Tumi Gudmundsson, Nils Gies, Thórdís Högnadóttir, Ásta Rut Hjartardóttir, et al. 2023. <span>“Digital <span>Elevation</span> <span>Models</span>, Orthoimages and Lava Outlines of the 2021 <span>Fagradalsfjall</span> Eruption: Results from Near Real-Time Photogrammetric Monitoring.”</span> Zenodo. <a href="https://doi.org/10.5281/zenodo.7866738 ">https://doi.org/10.5281/zenodo.7866738 </a>.
</div>
</div>
</section>
<section id="sec-session" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> R Session Info</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.4.1 (2024-06-14)
 os       Ubuntu 22.04.4 LTS
 system   x86_64, linux-gnu
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Etc/UTC
 date     2024-07-11
 pandoc   3.2 @ /usr/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package      * version     date (UTC) lib source
 abind        * 1.4-5       2016-07-21 [1] RSPM (R 4.4.0)
 anytime        0.3.9       2020-08-27 [1] RSPM (R 4.4.0)
 base64enc      0.1-3       2015-07-28 [1] RSPM (R 4.4.0)
 bit            4.0.5       2022-11-15 [1] RSPM (R 4.4.0)
 bit64          4.0.5       2020-08-30 [1] RSPM (R 4.4.0)
 class          7.3-22      2023-05-03 [2] CRAN (R 4.4.1)
 classInt       0.4-10      2023-09-05 [1] RSPM (R 4.4.0)
 cli            3.6.3       2024-06-21 [1] RSPM (R 4.4.0)
 codetools      0.2-20      2024-03-31 [2] CRAN (R 4.4.1)
 colorspace     2.1-0       2023-01-23 [1] RSPM (R 4.4.0)
 cols4all       0.7-1       2024-03-12 [1] RSPM (R 4.4.0)
 crayon         1.5.3       2024-06-20 [1] RSPM (R 4.4.0)
 crosstalk      1.2.1       2023-11-23 [1] RSPM (R 4.4.0)
 cubble       * 0.3.1       2024-07-02 [1] RSPM (R 4.4.0)
 cubelyr        1.0.2       2022-11-07 [1] RSPM (R 4.4.0)
 data.table     1.15.4      2024-03-30 [1] RSPM (R 4.4.0)
 DBI            1.2.3       2024-06-02 [1] RSPM (R 4.4.0)
 dichromat      2.0-0.1     2022-05-02 [1] RSPM (R 4.4.0)
 digest         0.6.36      2024-06-23 [1] RSPM (R 4.4.0)
 dplyr        * 1.1.4       2023-11-17 [1] RSPM (R 4.4.0)
 e1071          1.7-14      2023-12-06 [1] RSPM (R 4.4.0)
 ellipsis       0.3.2       2021-04-29 [1] RSPM (R 4.4.0)
 evaluate       0.24.0      2024-06-10 [1] RSPM (R 4.4.0)
 fansi          1.0.6       2023-12-08 [1] RSPM (R 4.4.0)
 farver         2.1.2       2024-05-13 [1] RSPM (R 4.4.0)
 fastmap        1.2.0       2024-05-15 [1] RSPM (R 4.4.0)
 generics       0.1.3       2022-07-05 [1] RSPM (R 4.4.0)
 ggnewscale   * 0.4.10.9000 2024-07-11 [1] Github (eliocamp/ggnewscale@4391903)
 ggplot2      * 3.5.1       2024-04-23 [1] RSPM (R 4.4.0)
 glue           1.7.0       2024-01-09 [1] RSPM (R 4.4.0)
 gtable         0.3.5       2024-04-22 [1] RSPM (R 4.4.0)
 here         * 1.0.1       2020-12-13 [1] RSPM (R 4.4.0)
 hms            1.1.3       2023-03-21 [1] RSPM (R 4.4.0)
 htmltools      0.5.8.1     2024-04-04 [1] RSPM (R 4.4.0)
 htmlwidgets    1.6.4       2023-12-06 [1] RSPM (R 4.4.0)
 jsonlite       1.8.8       2023-12-04 [1] RSPM (R 4.4.0)
 KernSmooth     2.23-24     2024-05-17 [2] CRAN (R 4.4.1)
 knitr          1.48        2024-07-07 [1] RSPM (R 4.4.0)
 labeling       0.4.3       2023-08-29 [1] RSPM (R 4.4.0)
 lattice        0.22-6      2024-03-20 [2] CRAN (R 4.4.1)
 leafem         0.2.3       2023-09-17 [1] RSPM (R 4.4.0)
 leaflegend     1.2.1       2024-05-09 [1] RSPM (R 4.4.0)
 leaflet        2.2.2       2024-03-26 [1] RSPM (R 4.4.0)
 leafsync       0.1.0       2019-03-05 [1] RSPM (R 4.4.0)
 lifecycle      1.0.4       2023-11-07 [1] RSPM (R 4.4.0)
 lubridate      1.9.3       2023-09-27 [1] RSPM (R 4.4.0)
 lwgeom         0.2-15      2024-07-11 [1] Github (r-spatial/lwgeom@304022f)
 magrittr       2.0.3       2022-03-30 [1] RSPM (R 4.4.0)
 munsell        0.5.1       2024-04-01 [1] RSPM (R 4.4.0)
 ncdf4          1.22        2023-11-28 [1] RSPM (R 4.4.0)
 patchwork    * 1.2.0       2024-01-08 [1] RSPM (R 4.4.0)
 pillar         1.9.0       2023-03-22 [1] RSPM (R 4.4.0)
 pkgconfig      2.0.3       2019-09-22 [1] RSPM (R 4.4.0)
 png            0.1-8       2022-11-29 [1] RSPM (R 4.4.0)
 proxy          0.4-27      2022-06-09 [1] RSPM (R 4.4.0)
 purrr        * 1.0.2       2023-08-10 [1] RSPM (R 4.4.0)
 R6             2.5.1       2021-08-19 [1] RSPM (R 4.4.0)
 raster         3.6-26      2023-10-14 [1] RSPM (R 4.4.0)
 RColorBrewer   1.1-3       2022-04-03 [1] RSPM (R 4.4.0)
 Rcpp           1.0.12      2024-01-09 [1] RSPM (R 4.4.0)
 readr        * 2.1.5       2024-01-10 [1] RSPM (R 4.4.0)
 rlang          1.1.4       2024-06-04 [1] RSPM (R 4.4.0)
 rmarkdown      2.27        2024-05-17 [1] RSPM (R 4.4.0)
 rprojroot      2.0.4       2023-11-05 [1] RSPM (R 4.4.0)
 rstudioapi     0.16.0      2024-03-24 [1] RSPM (R 4.4.0)
 scales         1.3.0       2023-11-28 [1] RSPM (R 4.4.0)
 sessioninfo    1.2.2       2021-12-06 [1] RSPM (R 4.4.0)
 sf           * 1.0-17      2024-07-11 [1] Github (r-spatial/sf@0ef309a)
 sp             2.1-4       2024-04-30 [1] RSPM (R 4.4.0)
 spacesXYZ      1.3-0       2024-01-23 [1] RSPM (R 4.4.0)
 stars        * 0.6-6       2024-07-11 [1] Github (r-spatial/stars@464e224)
 stringi        1.8.4       2024-05-06 [1] RSPM (R 4.4.0)
 stringr      * 1.5.1       2023-11-14 [1] RSPM (R 4.4.0)
 terra          1.7-78      2024-05-22 [1] RSPM (R 4.4.0)
 tibble         3.2.1       2023-03-20 [1] RSPM (R 4.4.0)
 tidyr        * 1.3.1       2024-01-24 [1] RSPM (R 4.4.0)
 tidyselect     1.2.1       2024-03-11 [1] RSPM (R 4.4.0)
 timechange     0.3.0       2024-01-18 [1] RSPM (R 4.4.0)
 tmap         * 4.0         2024-07-11 [1] Github (r-tmap/tmap@b303e4d)
 tmaptools      3.1-1       2021-01-19 [1] RSPM (R 4.4.0)
 tsibble      * 1.1.5       2024-06-27 [1] RSPM (R 4.4.0)
 tzdb           0.4.0       2023-05-12 [1] RSPM (R 4.4.0)
 units        * 0.8-5       2023-11-28 [1] RSPM (R 4.4.0)
 utf8           1.2.4       2023-10-22 [1] RSPM (R 4.4.0)
 vctrs          0.6.5       2023-12-01 [1] RSPM (R 4.4.0)
 viridisLite    0.4.2       2023-05-02 [1] RSPM (R 4.4.0)
 vroom          1.6.5       2023-12-05 [1] RSPM (R 4.4.0)
 widgetframe    0.3.1       2017-12-20 [1] RSPM (R 4.4.0)
 withr          3.0.0       2024-01-16 [1] RSPM (R 4.4.0)
 xfun           0.45        2024-06-16 [1] RSPM (R 4.4.0)
 XML            3.99-0.17   2024-06-25 [1] RSPM (R 4.4.0)
 yaml           2.3.9       2024-07-05 [1] RSPM (R 4.4.0)

 [1] /usr/local/lib/R/site-library
 [2] /usr/local/lib/R/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>